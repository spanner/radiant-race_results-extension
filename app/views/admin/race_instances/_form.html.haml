= render_region :form_top

- if @race_instance.errors.any?
  %p.haserror
    Sorry: there were problems:
    %br
    = @race_instance.errors.full_messages

- render_region :form do |form|
  - form.edit_title do
    %p.title
      = f.label :name, "Label to identify this results set (eg '2010')"
      = f.text_field :name, :class => 'textbox', :maxlength => 100 

  - form.edit_metadata do
    #extended-metadata{ :class => "row", :style => "display: none" }
      %table.fieldset{ :cellpadding => "0", :cellspacing => "0", :border => "0" }
        %tr
          %td.label
            = f.label :slug, 'Slug'
          %td.field
            = f.text_field :slug, :class => 'textbox', :maxlength => 255 
        = render_region :extended_metadata
    %p
      %small
        %a{ :id => "more-extended-metadata", :href => "#", :onclick => "#{toggle_javascript_for('extended-metadata')}; return false;" } More
        %a{ :id => "less-extended-metadata", :href => "#", :onclick => "#{toggle_javascript_for('extended-metadata')}; return false;", :style => "display: none" } Less

  - form.edit_start do
    %p.start
      = f.label :start, "Start time and date"
      = calendar_date_select :race_instance, :started_at

  - form.edit_file do
    %p.upload
      %label.upload Choose a file to upload
      = f.file_field :results, :class => "", :style => "width: 100%"

  - form.edit_checkpoints do
    %h3
      Checkpoints
      
    %p.decision
      - if @race_instance.checkpoints.any?
        = radio_button_tag :get_checkpoints, 'keep', true, :id => 'keep_checkpoints'
        %label{:for => 'keep_checkpoints'} Use existing set
        %span.form_note 
          - @race_instance.checkpoints.map(&:name).to_sentence
        %br
      
      - previous_instance = @race.latest
      = radio_button_tag :get_checkpoints, 'previous', !@race_instance.checkpoints.any? && !previous_instance.nil?, :id => 'previous_checkpoints', :disabled => !previous_instance.nil?
      %label{:for => 'previous_checkpoints', :class => previous_instance.nil? ? 'disabled' : ''} 
        Same as the 
        - if previous_instance
          = link_to previous_instance.name, admin_edit_race_instance_url(previous_instance)
        - else
          last
        set
      %br
      = radio_button_tag :get_checkpoints, 'file', false, :id => 'file_checkpoints'
      %label{:for => 'previous_checkpoints'} In the file
      %span.form_note (make sure header line has checkpoint names)
      %br
      = radio_button_tag :get_checkpoints, 'no', false, :id => 'no_checkpoints'
      %label{:for => 'no_checkpoints'} No checkpoints
      %span.form_note (just a finish time)